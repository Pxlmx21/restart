# main_app.py

import streamlit as st
import pandas as pd
from datetime import datetime, date
import os

st.set_page_config(page_title="‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", layout="centered")

st.title("üìÑ ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß")

# ----------- ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡πÄ‡∏Ç‡∏ï ‡πÅ‡∏Ç‡∏ß‡∏á ‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢) --------
# ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠ ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ
provinces = {
    "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£": {
        "‡πÄ‡∏Ç‡∏ï": ["‡πÄ‡∏Ç‡∏ï‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£", "‡πÄ‡∏Ç‡∏ï‡∏î‡∏∏‡∏™‡∏¥‡∏ï"],
        "‡πÅ‡∏Ç‡∏ß‡∏á": ["‡πÅ‡∏Ç‡∏ß‡∏á‡∏ß‡∏±‡∏î‡∏™‡∏≤‡∏°‡∏û‡∏£‡∏∞‡∏¢‡∏≤", "‡πÅ‡∏Ç‡∏ß‡∏á‡∏ñ‡∏ô‡∏ô‡∏ô‡∏Ñ‡∏£‡πÑ‡∏ä‡∏¢‡∏®‡∏£‡∏µ"],
        "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå": ["10200", "10300"]
    },
    "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà": {
        "‡πÄ‡∏Ç‡∏ï": ["‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏™‡∏±‡∏ô‡∏ó‡∏£‡∏≤‡∏¢"],
        "‡πÅ‡∏Ç‡∏ß‡∏á": ["‡∏ä‡πâ‡∏≤‡∏á‡∏°‡πà‡∏≠‡∏¢", "‡∏™‡∏∏‡πÄ‡∏ó‡∏û"],
        "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå": ["50000", "50210"]
    },
    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
}

# --------- ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ----------
with st.form("personal_form"):
    st.subheader("1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•")
    full_name = st.text_input("‡∏ä‡∏∑‡πà‡∏≠ - ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•")
    birth_date = st.date_input("‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î", min_value=date(1900, 1, 1), max_value=date.today())
    age = date.today().year - birth_date.year - ((date.today().month, date.today().day) < (birth_date.month, birth_date.day))
    st.text_input("‡∏≠‡∏≤‡∏¢‡∏∏ (‡∏õ‡∏µ)", value=str(age), disabled=True)

    st.subheader("2. ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó")
    house_no = st.text_input("‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà")

    province = st.selectbox("‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î", list(provinces.keys()))
    district = st.selectbox("‡πÄ‡∏Ç‡∏ï", provinces[province]["‡πÄ‡∏Ç‡∏ï"])
    sub_district = st.selectbox("‡πÅ‡∏Ç‡∏ß‡∏á", provinces[province]["‡πÅ‡∏Ç‡∏ß‡∏á"])
    zipcode = st.selectbox("‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå", provinces[province]["‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå"])

    st.subheader("3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠")
    phone = st.text_input("‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ")

    st.subheader("4. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞")
    status = st.selectbox("‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞", ["‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠", "‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢"])

    submitted = st.form_submit_button("‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")

if submitted:
    # ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
    data = {
        "‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•": [full_name],
        "‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î": [birth_date.strftime("%Y-%m-%d")],
        "‡∏≠‡∏≤‡∏¢‡∏∏": [age],
        "‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà": [house_no],
        "‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î": [province],
        "‡πÄ‡∏Ç‡∏ï": [district],
        "‡πÅ‡∏Ç‡∏ß‡∏á": [sub_district],
        "‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå": [zipcode],
        "‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå": [phone],
        "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞": [status],
        "‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•": [datetime.now().strftime("%Y-%m-%d %H:%M:%S")]
    }

    df = pd.DataFrame(data)

    file_name = "data.xlsx"
    if os.path.exists(file_name):
        existing = pd.read_excel(file_name)
        df = pd.concat([existing, df], ignore_index=True)

    df.to_excel(file_name, index=False)
    st.success("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß!")

    # ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö (‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡∏£‡∏π‡πâ password)
    with st.expander("üîí ‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö: ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"):
        password = st.text_input("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô", type="password")
        if password == "admin123":  # ‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
            st.download_button(
                label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel",
                data=open(file_name, "rb"),
                file_name="‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô.xlsx",
                mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
            )
        elif password:
            st.error("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á")

